<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Instantly - Internet Share</title>
    <link rel="icon" type="image/x-icon" href="./img/icon.ico" />
    <link
      href="https://fonts.googleapis.com/css2?family=Comfortaa&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="./css/tranfer.css" />
    <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <script>
      function getParameterByName(name, url = window.location.href) {
        if (typeof URLSearchParams === "undefined" || typeof URL === "undefined") {
          name = name.replace(/[\[\]]/g, "\\$&");
          var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
          if (!results) return null;
          if (!results[2]) return "";
          return decodeURIComponent(results[2].replace(/\+/g, " "));
        } else {
          const searchParams = new URLSearchParams(new URL(url).search);
          return searchParams.get(name) || null;
        }
      }
      var room_id;
      if (getParameterByName("room_id") == undefined) {
        room_id = (Math.random() + 1).toString(36).substring(2);
        window.location.href = window.location.href + "?room_id=" + room_id;
      } else room_id = getParameterByName("room_id");
    </script>
    <div class="container">
      <div class="col-left bg-gradient-primary-to-secondary">
        <div class="left-box">
          <div id="sendAlert" hidden>
            <div class="alert alert-success" role="alert">
              File(s) sent <strong>Successfully!!</strong>
              </div>
          </div>
          <div class="waiting-area">
            <h2 style="color: white">Waiting for Peer</h2>
            <img src="./img/waitingForPeer.gif" />
          </div>
          <div class="modal" id="modalGet">
            <div class="modal-content">
              <span class="close">&times;</span>
              <div id="qrcode"></div>
            </div>
          </div>
          <div class="modal" id="modalScan">
            <div class="modal-content">
              <span class="close" id="modalSpan">&times;</span>
              <div id="qr-reader"></div>
            </div>
          </div>
          <div class="drop-area" style="display: none">
            <p id="drop_zone_text">
              Drag one or more files to this <i>drop zone</i>.<br />
            </p>

            <div
              id="drop_zone"
              ondrop="dropHandler(event);"
              ondragover="dragOverHandler(event);"
            >
              <input type="file" id="fileinput" multiple/>
            </div>

            <br />
            <button id="sendFileBtn">send</button>
          </div>

          <div class="stats-area">
            <div class="fileprogress-box">
              <span id="filetransfer-text">Uploading</span>
              <span id="speed"></span> <br />
              <span id="filename-text"></span><br />
              <div class="progress" id="progress">0%</div>

              <div class="progress-bar">
                <div class="progress-bar-fill" style="height: 24px"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-right">
        <div class="right-box">
          <a href="./index.html">
            <img src="./img/logo.jpg" height="186px" width="420px"/>
          </a>
          <br />
          <br />
          <div class="roomcode-box">
            Room Link:<br />
            <input type="text" id="room_id" />
            <br>
            <button id="copy" class="btn btn-outline-primary">Copy</button>
            <button id="getQR" class="btn btn-outline-primary">Get QRCode</button>
            <button id="scanQR" class="btn btn-outline-primary">Scan QRCode</button>
          </div>
          <br />
          <msglist></msglist>
          <br />
          <div class="info-box">
            My Peer ID: <mypeerid></mypeerid>
            <br />

            <p class="speedlogs"></p>

            PeerList
            <list> </list>
          </div>
        </div>
      </div>
    </div>

    <script>
      function dragOverHandler(ev) {
        console.log("File(s) in drop zone");

        // Prevent default behavior (Prevent file from being opened)
        ev.preventDefault();
      }
      function dropHandler(ev) {
        console.log("File(s) dropped");

        // Prevent default behavior (Prevent file from being opened)
        ev.preventDefault();
        document.body.style.backgroundColor = "lightgreen";
        var files = ev.dataTransfer.files;

        if (files.length > 1) {
          $("#drop_zone_text").html(
            files.length + " files dropped. Start sending file(s) now!"
          );
        } else {
          var filename = files[0].name;
          $("#drop_zone_text").html(filename + "<br>Start sending file now!");
        }

        $("#sendFileBtn").show();
        $("#fileinput").hide();
      }

      $(document).ready(function () {
        $("#fileinput").change(function () {
          var files = $(this)[0].files;

          if (files.length > 1) {
            $("#drop_zone_text").html(
              files.length + " files selected. Start sending file(s) now!"
            );
          } else {
            var filename = files[0].name;
            $("#drop_zone_text").html(filename + "<br>Start sending file now!");
          }

          $("#sendFileBtn").show();
        });
      });
    </script>

    <!-- Firebase App is always required and must be first -->
    <script src="https://www.gstatic.com/firebasejs/5.0.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.0.1/firebase-database.js"></script>

    <script>

      // Your web app's Firebase configuration
      const firebaseConfig = {
    apiKey: "AIzaSyAK9C8VbI055bv2DNMOD_HaXuA2jBf9_g0",
    authDomain: "instantly-77997.firebaseapp.com",
    projectId: "instantly-77997",
    storageBucket: "instantly-77997.appspot.com",
    messagingSenderId: "327612975601",
    appId: "1:327612975601:web:f6e9217bf51e053b5e5c50",
    measurementId: "G-Z52CBPBZ5W",
    databaseURL: "https://instantly-77997-default-rtdb.firebaseio.com/"
    };

      // Initialize Firebase
      const app = firebase.initializeApp(firebaseConfig);
      // Initialize Realtime Database and get a reference to the service
      const database = firebase.database();

      // const database = getDatabase(app);
    </script>
    <script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="./js/utility.js"></script>
    <script type="module" src="./js/peerConnection.js"></script>
    <script type="module" src="./js/firebaseSignalingServer.js"></script>

    <script>
      $("#room_id").val(
        location.origin + location.pathname + "?room_id=" + room_id
      );
    </script>
    <script type="module" src="./js/fileHandling.js"></script>
  </body>
</html>
